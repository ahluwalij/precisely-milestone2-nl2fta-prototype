<p-toast></p-toast>

<div class="aws-credentials-content">
  <div class="config-steps">
    <!-- Step 1: Enter Credentials -->
    <div class="step-section">
      <h3 class="step-title">
        <i class="pi pi-key"></i>
        Step 1: Enter AWS Credentials
      </h3>

      <div class="form-grid">
        <div class="form-field">
          <label for="accessKeyId">Access Key ID *</label>
          <input
            id="accessKeyId"
            type="password"
            pInputText
            [(ngModel)]="accessKeyId"
            [disabled]="credentialsValidated"
            placeholder="Enter your AWS Access Key ID"
            (input)="onInputChange('accessKeyId', $event)"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
          />
          <small class="credential-display" *ngIf="accessKeyId && accessKeyId.length > 0">
            {{ getDisplayValue('accessKeyId') }}
          </small>
        </div>

        <div class="form-field">
          <label for="secretAccessKey">Secret Access Key *</label>
          <input
            id="secretAccessKey"
            type="password"
            pInputText
            [(ngModel)]="secretAccessKey"
            [disabled]="credentialsValidated"
            placeholder="Enter your AWS Secret Access Key"
            (input)="onInputChange('secretAccessKey', $event)"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
          />
          <small class="credential-display" *ngIf="secretAccessKey && secretAccessKey.length > 0">
            {{ getDisplayValue('secretAccessKey') }}
          </small>
        </div>
      </div>

      <div class="step-actions">
        <p-button
          label="Validate Credentials"
          icon="pi pi-check"
          [loading]="isValidating"
          [disabled]="!accessKeyId || !secretAccessKey || credentialsValidated"
          (onClick)="validateCredentials()"
        >
        </p-button>
      </div>
    </div>

    <p-divider></p-divider>

    <!-- Step 2: Select Region -->
    <div class="step-section" [class.disabled]="!credentialsValidated">
      <h3 class="step-title">
        <i class="pi pi-globe"></i>
        Step 2: Select AWS Region
      </h3>

      <div class="form-field">
        <label for="region">Available Bedrock Regions</label>
        <p-dropdown
          id="region"
          [(ngModel)]="selectedRegion"
          [options]="regionOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Select a region"
          [disabled]="!credentialsValidated || isLoadingModels || isConfiguring || isIndexing || isValidatingRegions"
          (onChange)="onRegionChange()"
          [style]="{ width: '100%' }"
        >
        </p-dropdown>

        <small class="field-hint" *ngIf="isValidatingRegions">
          Validating model access for regions...
        </small>
        <small class="field-hint" *ngIf="!isValidatingRegions && regionOptions.length > 0">
          {{ regionOptions.length }} region(s) available with Bedrock access
        </small>
      </div>
    </div>

  </div>

  <!-- Action Buttons -->
  <div class="dialog-actions">
    <p-button
      [label]="buttonLabel"
      [icon]="buttonIcon"
      [loading]="isConfiguring"
      [disabled]="!isFormValid || isIndexing || isConnected"
      (onClick)="configure()"
      class="progress-button"
      [style]="isIndexing ? {'position': 'relative', 'overflow': 'hidden'} : {}"
      [severity]="isConnected ? 'success' : 'primary'"
    >
      <div 
        *ngIf="isIndexing" 
        class="progress-bar" 
        [style.width.%]="indexingProgress"
        style="position: absolute; top: 0; left: 0; height: 100%; background: rgba(255,255,255,0.1); transition: width 0.3s ease; pointer-events: none;"
      ></div>
    </p-button>
  </div>
</div>
